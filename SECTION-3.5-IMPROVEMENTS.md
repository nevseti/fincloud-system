# –£–ª—É—á—à–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ 3.5 - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∫–∏

## üìç –ì–¥–µ –∏ —á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

---

### 1. –†–ê–°–®–ò–†–ò–¢–¨ –û–ü–ò–°–ê–ù–ò–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø (—Å—Ç—Ä–æ–∫–∞ 268)

**–ë–´–õ–û:**
```
–°–Ω–∞—á–∞–ª–∞ GitHub-hosted runner –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, API-—Ç–µ—Å—Ç—ã, —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ E2E.
```

**–°–¢–ê–õ–û:**
```
–°–Ω–∞—á–∞–ª–∞ GitHub-hosted runner –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (auth-service, finance-service), –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏, API-—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ endpoints, —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (JWT-—Ç–æ–∫–µ–Ω—ã, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π) –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ E2E, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –ø–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
```

---

### 2. –î–û–ë–ê–í–ò–¢–¨ –ü–†–ò–ú–ï–†–´ –¢–ï–°–¢–û–í –ü–û–°–õ–ï –°–¢–†–û–ö–ò 272

**–î–û–ë–ê–í–ò–¢–¨ –ü–û–°–õ–ï –°–¢–†–û–ö–ò 272** (–ø–æ—Å–ª–µ "–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–∞–±–æ—á—É—é —Å—Ä–µ–¥—É."):

```
–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞. –ü—Ä–∏–º–µ—Ä unit-—Ç–µ—Å—Ç–∞ –¥–ª—è auth-service –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –õ–∏—Å—Ç–∏–Ω–≥–µ 9, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É health endpoint, –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π.

def test_health_endpoint():
    """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞"""
    response = client.get('/health')
    assert response.status_code == 200
    assert response.json() == {"status": "ok"}

def test_user_registration_validation_empty():
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"""
    response = client.post('/register', json={})
    assert response.status_code == 422

def test_password_hashing():
    """–¢–µ—Å—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π —Å –ø–æ–º–æ—â—å—é bcrypt"""
    password = 'test_password_123'
    hashed = get_password_hash(password)
    assert hashed != password
    assert verify_password(password, hashed) == True
    assert verify_password('wrong_password', hashed) == False

–õ–∏—Å—Ç–∏–Ω–≥ 9 ‚Äì –ü—Ä–∏–º–µ—Ä—ã unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è auth-service

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏. –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ auth-service –∏ finance-service, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –õ–∏—Å—Ç–∏–Ω–≥–µ 10.

def test_auth_finance_integration():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è auth –∏ finance —Å–µ—Ä–≤–∏—Å–æ–≤"""
    # 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_data = {
        'email': 'integration_test@example.com',
        'password': 'testpass123',
        'role': 'accountant',
        'branch_id': 1
    }
    register_response = auth_client.post('/register', json=user_data)
    assert register_response.status_code in [200, 400]
    
    # 2. –í—Ö–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
    login_response = auth_client.post('/login', json={
        'email': user_data['email'],
        'password': user_data['password']
    })
    assert login_response.status_code == 200
    token = login_response.json()['access_token']
    
    # 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ finance —Å–µ—Ä–≤–∏—Å—É
    balance_response = finance_client.get(
        '/balance',
        headers={'Authorization': f'Bearer {token}'}
    )
    assert balance_response.status_code == 200
    assert 'total_balance' in balance_response.json()

–õ–∏—Å—Ç–∏–Ω–≥ 10 ‚Äì –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

End-to-End —Ç–µ—Å—Ç—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –ø–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π. –ü—Ä–∏–º–µ—Ä E2E-—Ç–µ—Å—Ç–∞, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –≤—Ö–æ–¥, —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–ª–∞–Ω—Å–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –õ–∏—Å—Ç–∏–Ω–≥–µ 11.

def test_complete_user_journey():
    """E2E —Ç–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è"""
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    user_data = {
        'email': 'e2e_test@example.com',
        'password': 'password123',
        'role': 'accountant',
        'branch_id': 1
    }
    auth_client.post('/register', json=user_data)
    
    # –í—Ö–æ–¥
    login_response = auth_client.post('/login', json={
        'email': user_data['email'],
        'password': user_data['password']
    })
    token = login_response.json()['access_token']
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
    balance = finance_client.get('/balance', 
        headers={'Authorization': f'Bearer {token}'})
    assert balance.status_code == 200
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
    operations = [
        {'type': 'income', 'amount': 10000.0, 'description': 'Income 1', 'branch_id': 1},
        {'type': 'expense', 'amount': 2000.0, 'description': 'Expense 1', 'branch_id': 1},
    ]
    for op in operations:
        response = finance_client.post('/operations', json=op,
            headers={'Authorization': f'Bearer {token}'})
        assert response.status_code == 200
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
    updated_balance = finance_client.get('/balance',
        headers={'Authorization': f'Bearer {token}'})
    assert updated_balance.json()['total_balance'] >= 8000.0

–õ–∏—Å—Ç–∏–Ω–≥ 11 ‚Äì –ü—Ä–∏–º–µ—Ä E2E-—Ç–µ—Å—Ç–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

–í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –≤ –≤–µ—Ç–∫—É main. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ GitHub Actions –∏ –≤–∫–ª—é—á–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python, –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ö–µ–º, —Ä–∞–±–æ—Ç—ã endpoints –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤ –∏ –∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker Swarm.
```

---

### 3. –û–ë–ù–û–í–ò–¢–¨ –ù–û–ú–ï–†–ê–¶–ò–Æ –õ–ò–°–¢–ò–ù–ì–û–í

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ª–∏—Å—Ç–∏–Ω–≥–æ–≤ 9, 10, 11:
- **–°—Ç–∞—Ä—ã–π –õ–∏—Å—Ç–∏–Ω–≥ 8** –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å (—à–∞–≥–∏ –¥–µ–ø–ª–æ—è)
- **–ù–æ–≤—ã–π –õ–∏—Å—Ç–∏–Ω–≥ 9** - unit-—Ç–µ—Å—Ç—ã
- **–ù–æ–≤—ã–π –õ–∏—Å—Ç–∏–Ω–≥ 10** - integration-—Ç–µ—Å—Ç—ã  
- **–ù–æ–≤—ã–π –õ–∏—Å—Ç–∏–Ω–≥ 11** - E2E-—Ç–µ—Å—Ç—ã

---

### 4. –î–û–ë–ê–í–ò–¢–¨ –¢–ê–ë–õ–ò–¶–£ –° –†–ï–ó–£–õ–¨–¢–ê–¢–ê–ú–ò (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –õ–∏—Å—Ç–∏–Ω–≥–∞ 11:

```
–¢–∞–±–ª–∏—Ü–∞ 4 ‚Äì –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –≤ CI/CD-–∫–æ–Ω–≤–µ–π–µ—Ä–µ

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-------------------|--------|----------|
| Unit (auth-service) | 10 | ‚úÖ PASSED | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| Unit (finance-service) | 7 | ‚úÖ PASSED | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ |
| Integration | 4 | ‚úÖ PASSED | –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ |
| API | 2 | ‚úÖ PASSED | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ endpoints |
| Security | 4 | ‚úÖ PASSED | JWT, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π, –≤–∞–ª–∏–¥–∞—Ü–∏—è |
| E2E | 1 | ‚úÖ PASSED | –ü–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π |
```

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ 3.5:

1. **–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ** (—Å—Ç—Ä–æ–∫–∞ 268) - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–û–ø–∏—Å–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏** (—Å—Ç—Ä–æ–∫–∞ 269)
3. **–û–ø–∏—Å–∞–Ω–∏–µ –¥–µ–ø–ª–æ—è** (—Å—Ç—Ä–æ–∫–∞ 270-271)
4. **–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∞ 272)
5. **–ù–û–í–û–ï: –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤** (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 272)
   - –õ–∏—Å—Ç–∏–Ω–≥ 9 - Unit-—Ç–µ—Å—Ç—ã
   - –õ–∏—Å—Ç–∏–Ω–≥ 10 - Integration-—Ç–µ—Å—Ç—ã
   - –õ–∏—Å—Ç–∏–Ω–≥ 11 - E2E-—Ç–µ—Å—Ç—ã
   - –¢–∞–±–ª–∏—Ü–∞ 4 - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. **–õ–∏—Å—Ç–∏–Ω–≥ 8** - –®–∞–≥–∏ –¥–µ–ø–ª–æ—è (–æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å)

---

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–°—Ç—Ä–æ–∫–∞ 268** - —Ä–∞—Å—à–∏—Ä–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 272** - –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ç–µ—Å—Ç–æ–≤ (–õ–∏—Å—Ç–∏–Ω–≥–∏ 9, 10, 11)
3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** - –¥–æ–±–∞–≤–∏—Ç—å –¢–∞–±–ª–∏—Ü—É 4 —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

–í—Å—ë –≥–æ—Ç–æ–≤–æ! –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π —Ç–µ–∫—Å—Ç –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –Ω—É–∂–Ω—ã–µ –º–µ—Å—Ç–∞.

