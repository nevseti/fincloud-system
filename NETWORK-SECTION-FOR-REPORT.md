# Раздел про сетевое взаимодействие для отчета

## Где добавить:
**После строки 137 в разделе 2.2**, перед "Рисунок 1"

---

## Текст для добавления:

### 2.2.1. Сетевая архитектура и взаимодействие сервисов

Сетевая инфраструктура системы FinCloud построена на основе overlay-сети Docker Swarm, обеспечивающей изолированное и безопасное взаимодействие между микросервисами. Overlay-сеть представляет собой виртуальную сеть, которая создаётся поверх физической сети хоста и позволяет контейнерам, запущенным на разных узлах кластера, общаться друг с другом как будто они находятся в одной локальной сети.

В проекте используется overlay-сеть с именем `fincloud-network`, которая автоматически создаётся при развёртывании стека через команду `docker stack deploy`. Все сервисы системы подключены к этой сети, что обеспечивает:

1. **Изоляцию от внешнего мира**: PostgreSQL доступен только внутри overlay-сети, что исключает возможность прямого подключения извне и повышает безопасность базы данных.

2. **DNS-резолюцию сервисов**: Docker Swarm автоматически создаёт DNS-записи для каждого сервиса, позволяя обращаться к ним по имени. Например, сервис `auth-service` доступен по адресу `auth-service:8000` внутри сети, а `postgres` – по адресу `postgres:5432`.

3. **Автоматическую маршрутизацию**: Swarm автоматически маршрутизирует трафик между контейнерами, даже если они запущены на разных узлах кластера.

**Таблица 4 – Сетевая конфигурация сервисов**

| Сервис | Внутренний адрес | Порт | Внешний порт | Доступность |
|--------|-----------------|------|--------------|-------------|
| Frontend | frontend:80 | 80 | 8080 | Публичный (через Port Forwarding) |
| Auth-service | auth-service:8000 | 8000 | 8000 | Публичный (через Port Forwarding) |
| Finance-service | finance-service:8001 | 8001 | 8001 | Публичный (через Port Forwarding) |
| Report-service | report-service:8002 | 8002 | 8002 | Публичный (через Port Forwarding) |
| PostgreSQL | postgres:5432 | 5432 | - | Только внутри overlay-сети |

**Межсервисное взаимодействие** организовано через HTTP-запросы с использованием стандартных REST API. Frontend-сервис обращается к backend-сервисам напрямую через их публичные порты, используя fetch-запросы из JavaScript-кода. Например, для аутентификации выполняется запрос к `http://localhost:8000/login`, а для получения баланса – к `http://localhost:8001/balance`.

Backend-сервисы взаимодействуют друг с другом через внутренние адреса overlay-сети. Report-service обращается к finance-service по адресу `http://finance-service:8001`, что обеспечивает более быструю и безопасную коммуникацию без необходимости прохождения через внешние порты.

**Port Forwarding VirtualBox** настроен для обеспечения доступа к сервисам с хост-машины. Правила проброса портов позволяют перенаправлять трафик с портов хоста на соответствующие порты внутри виртуальной машины:

- Порт 8080 хоста → порт 80 контейнера frontend
- Порт 8000 хоста → порт 8000 контейнера auth-service
- Порт 8001 хоста → порт 8001 контейнера finance-service
- Порт 8002 хоста → порт 8002 контейнера report-service

Такая конфигурация обеспечивает доступ к системе через `http://localhost:8080` с хост-машины, при этом все межсервисное взаимодействие происходит внутри изолированной overlay-сети Docker Swarm.

**Безопасность сетевого взаимодействия** обеспечивается на нескольких уровнях:

1. **Изоляция базы данных**: PostgreSQL доступен только внутри overlay-сети, что исключает возможность несанкционированного доступа извне.

2. **CORS (Cross-Origin Resource Sharing)**: Все backend-сервисы настроены для обработки cross-origin-запросов от фронтенда, что необходимо для корректной работы веб-приложения.

3. **JWT-аутентификация**: Все защищённые endpoints требуют наличия валидного JWT-токена в заголовке Authorization, что обеспечивает контроль доступа на уровне приложения.

4. **Отсутствие прямого доступа к БД**: Report-service не имеет прямого доступа к PostgreSQL и получает данные только через API finance-service, что соответствует принципам микросервисной архитектуры.

---

## Дополнительные детали (можно добавить):

### Пример конфигурации overlay-сети:

```yaml
networks:
  fincloud-network:
    driver: overlay
    attachable: true
```

Параметр `attachable: true` позволяет подключать к сети контейнеры, запущенные вне стека, что может быть полезно для отладки и тестирования.

### Проверка сетевой конфигурации:

После развёртывания стека можно проверить сетевую конфигурацию следующими командами:

```bash
# Список всех сетей
docker network ls

# Детали overlay-сети
docker network inspect fincloud-network

# Проверка подключения сервисов к сети
docker service ps fincloud_auth-service
```

Эти команды позволяют убедиться, что все сервисы корректно подключены к overlay-сети и могут взаимодействовать друг с другом.

