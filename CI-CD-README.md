# üöÄ FinCloud CI/CD Pipeline

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CI/CD pipeline –¥–ª—è FinCloud —Å–∏—Å—Ç–µ–º—ã.

## üìã –û–±–∑–æ—Ä

–ù–∞—à CI/CD pipeline –≤–∫–ª—é—á–∞–µ—Ç:

- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º push/PR
- **–°–±–æ—Ä–∫–∞** - —Å–æ–∑–¥–∞–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- **–î–µ–ø–ª–æ–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes
- **–ü—É–±–ª–∏–∫–∞—Ü–∏—è** - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤ –≤ GitHub Container Registry

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. GitHub Secrets

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ secrets –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```bash
# Kubernetes –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (base64 encoded)
KUBE_CONFIG_STAGING=<base64-encoded-kubeconfig-for-staging>
KUBE_CONFIG_PRODUCTION=<base64-encoded-kubeconfig-for-production>

# Docker Registry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DOCKER_USERNAME=<your-dockerhub-username>
DOCKER_PASSWORD=<your-dockerhub-password>
```

### 2. Environments

–°–æ–∑–¥–∞–π—Ç–µ environments –≤ GitHub:
- `staging` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `production` - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 3. Kubernetes Cluster

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—É:

```bash
# –ü–æ–ª—É—á–∏—Ç–µ kubeconfig
kubectl config view --raw > kubeconfig

# –ó–∞–∫–æ–¥–∏—Ä—É–π—Ç–µ –≤ base64
base64 -i kubeconfig -o kubeconfig.b64

# –î–æ–±–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ kubeconfig.b64 –≤ GitHub Secrets
```

## üéØ Workflows

### 1. CI/CD Pipeline (`.github/workflows/ci-cd.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` –∏–ª–∏ `develop`
- Pull Request –≤ `main`

**–≠—Ç–∞–ø—ã:**
1. **Test** - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
2. **Build** - —Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
3. **Deploy** - –¥–µ–ø–ª–æ–π –≤ Kubernetes

### 2. Testing (`.github/workflows/test.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –ª—é–±—É—é –≤–µ—Ç–∫—É
- Pull Request

**–¢–µ—Å—Ç—ã:**
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞ (flake8, black, isort)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å PostgreSQL

### 3. Security (`.github/workflows/security.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main`
- Pull Request –≤ `main`
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 2:00)

**–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (safety)
- Docker –æ–±—Ä–∞–∑—ã (Trivy)
- –°–µ–∫—Ä–µ—Ç—ã (TruffleHog)

### 4. Deploy (`.github/workflows/deploy.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Manual dispatch
- Push –≤ `main` (production)
- Push –≤ `develop` (staging)

**–û–∫—Ä—É–∂–µ–Ω–∏—è:**
- `staging` - —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- `production` - –ø—Ä–æ–¥–∞–∫—à–µ–Ω

### 5. Publish (`.github/workflows/publish.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞ `v*`
- Manual dispatch

**–î–µ–π—Å—Ç–≤–∏—è:**
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤ –≤ GitHub Container Registry
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è release notes

## üê≥ Docker Images

–û–±—Ä–∞–∑—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ GitHub Container Registry:

```
ghcr.io/<username>/fincloud-system/auth-service:<tag>
ghcr.io/<username>/fincloud-system/finance-service:<tag>
ghcr.io/<username>/fincloud-system/report-service:<tag>
ghcr.io/<username>/fincloud-system/frontend:<tag>
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install pytest pytest-asyncio httpx

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
cd auth-service && python -m pytest tests/ -v
cd finance-service && python -m pytest tests/ -v
cd report-service && python -m pytest tests/ -v
```

### –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
pip install flake8 black isort mypy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è
flake8 .
black --check .
isort --check-only .
mypy .
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞
git tag v1.0.0
git push origin v1.0.0

# –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç publish workflow
```

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions ‚Üí Deploy to Environments
2. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
3. –í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (staging/production)
4. –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç—É—Å Pipeline

- **–ó–µ–ª–µ–Ω—ã–π** ‚úÖ - –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏, –¥–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω
- **–ñ–µ–ª—Ç—ã–π** ‚ö†Ô∏è - —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –Ω–æ –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **–ö—Ä–∞—Å–Ω—ã–π** ‚ùå - —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏ –∏–ª–∏ –¥–µ–ø–ª–æ–π –Ω–µ—É–¥–∞—á–µ–Ω

### –õ–æ–≥–∏

–í—Å–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ GitHub Actions:
- –¢–µ—Å—Ç—ã: Actions ‚Üí Test
- –°–±–æ—Ä–∫–∞: Actions ‚Üí CI/CD Pipeline
- –î–µ–ø–ª–æ–π: Actions ‚Üí Deploy to Environments

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ Python –ø–∞–∫–µ—Ç–∞—Ö
- **Docker** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
- **–°–µ–∫—Ä–µ—Ç—ã** - –ø–æ–∏—Å–∫ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ security alerts –≤ GitHub
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Dependabot –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ branch protection rules

## üõ†Ô∏è Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Actions
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ
   - –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

2. **–î–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ kubeconfig
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

3. **Docker build –ø–∞–¥–∞–µ—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Kubernetes
kubectl get pods -n fincloud

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
kubectl logs deployment/auth-service -n fincloud

# –û—Ç–∫–∞—Ç –¥–µ–ø–ª–æ—è
kubectl rollout undo deployment/auth-service -n fincloud
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏

Pipeline –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤
- –í—Ä–µ–º—è –¥–µ–ø–ª–æ—è
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –¥–µ–ø–ª–æ–µ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è CI/CD:

1. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ workflow —Ñ–∞–π–ª—ã
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
3. –°–æ–∑–¥–∞–π—Ç–µ PR —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
4. –ü–æ—Å–ª–µ merge –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ CI/CD, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
